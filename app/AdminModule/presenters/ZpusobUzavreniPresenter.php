<?php/** * Description of ZpusobUzavreniPresenter * * @author Martin Patyk */namespace App\AdminModule\Presenters;use App\Grids\Admin\ZpusobUzavreniGrid;use App\Model\ZpusobUzavreniModel;use DibiException;use Nette\Application\AbortException;use Nette\Application\UI\Form;use Nette\Database\Context;use Nette\Diagnostics\Debugger;use Nette\InvalidArgumentException;use App\Form\Admin\Add\ZpusobUzavreniForm as AddZpusobUzavreniForm;use App\Form\Admin\Edit\ZpusobUzavreniForm as EditZpusobUzavreniForm;class ZpusobUzavreniPresenter extends AdminbasePresenter{    /** @var ZpusobUzavreniModel */    private $model;    /** @var Context */    private $netteModel;    public function __construct(Context $context, ZpusobUzavreniModel $model)    {        parent::__construct();        $this->model = $model;        $this->netteModel = $context;    }    /**     * Cast DEFAULT, definice Gridu     */    protected function createComponentGrid()    {        return new ZpusobUzavreniGrid($this->netteModel->table('zpusob_uzavreni'));    }    public function renderDefault()    {        $this->setView('../_default');    }    /**     * Cast ADD     */    public function actionAdd()    {        //	nastavim rule pro formular        $this['add']['nazev']            ->addRule(Form::FILLED);        $this['add']['koeficient_cena']            ->setType('number')            ->addRule(Form::FLOAT);        $this->setView('../_add');    }    public function createComponentAdd()    {        $form = new AddZpusobUzavreniForm;        $form->onSuccess[] = callback($this, 'add');        return $form;    }    /**     * @throws AbortException     */    public function add(AddZpusobUzavreniForm $form)    {        try {            $v = $form->getValues();            $this->model->insert($v);        } catch (DibiException $exc) {            Debugger::log($exc->getMessage());            $form->addError('Nový záznam nebyl přidán');        }        $this->flashMessage('Nový záznam byl přidán');        $this->redirect('default');    }    /**     * Cast EDIT     * @param int $id Identifikator polozky     * @throws AbortException     */    public function renderEdit($id)    {        try {            $this->setView('../_edit');            //	nactu hodnoty pro editaci, pritom overim jestli hodnoty existuji            $v = $this->model->fetch($id);            //	odeberu idecko z pole            $v->offsetUnset('id');            //	nastavim rule pro formular            $this['edit']['new']['nazev']                ->addRule(Form::FILLED);            $this['edit']['new']['koeficient_cena']                ->setType('number')                ->addRule(Form::FLOAT);            //	upravene hodnoty odeslu do formulare            $this['edit']->setDefaults(array('id' => $id, 'new' => $v));        } catch (InvalidArgumentException $exc) {            $this->flashMessage($exc->getMessage());            $this->redirect('default');        }    }    public function createComponentEdit()    {        $form = new EditZpusobUzavreniForm();        $form->onSuccess[] = callback($this, 'edit');        return $form;    }    /**     * @throws AbortException     */    public function edit(EditZpusobUzavreniForm $form)    {        try {            $v = $form->getValues();            $this->model->update($v['new'], $v['id']);        } catch (DibiException $exc) {            Debugger::log($exc->getMessage());            $form->addError('Záznam nebyl změněn');        }        $this->flashMessage('Záznam byl úspěšně změněn');        $this->redirect('default');    }    /**     * Cast DROP     * @param int $id Identifikator polozky     * @throws AbortException     */    public function actionDrop($id)    {        try {            $this->model->fetch($id);            $this->model->remove($id);            $this->flashMessage('Položka byla odebrána'); // Položka byla odebrána            $this->redirect('ZpusobUzavreni:default'); //	change it !!!        } catch (InvalidArgumentException $exc) {            $this->flashMessage($exc->getMessage());            $this->redirect('ZpusobUzavreni:default'); //	change it !!!        } catch (DibiException $exc) {            $this->flashMessage('Položka nebyla odabrána, zkontrolujte závislosti na položku');            $this->redirect('ZpusobUzavreni:default'); //	change it !!!        }    }}