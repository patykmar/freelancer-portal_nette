<?phpnamespace App\Grids\Klient;/** * Description of IncidentGrid * * @author Martin Patyk */use NiftyGrid\Grid;class IncidentGrid extends Grid{    private $model;    private $priorita;    private $stav;    private $firma;    private $ci;    /**     * @param database context $db Moznost prace s databazi     * @param int $firma ID firmy do ktere patri zakaznik     */    public function __construct($db, $firma)    {        parent::__construct();        $this->model = $db->table('incident')->where(array('ci.firma = ?' => $firma));        $this->priorita = $db->table('priorita');        $this->stav = $db->table('incident_stav');        $this->firma = $db->table('firma');        $this->ci = $db->table('ci')->where(array('ci.firma = ?' => $firma));    }    protected function configure($presenter)    {        //Vytvoříme si zdroj dat pro Grid        //Při výběru dat vždy vybereme id        $source = new \NiftyGrid\DataSource\NDataSource($this->model            ->select('CONCAT(typ_incident.zkratka, incident.id) AS idTxt')            ->select('incident.id AS id')            ->select('ci.nazev AS nazevCi')            ->select('ci.firma.nazev AS nazevFirmy')            ->select('incident_stav.nazev AS stav')            ->select('DATE_FORMAT(datum_ukonceni,GET_FORMAT(DATETIME,"EUR")) AS datum_ukonceni')            ->select('DATE_FORMAT(datum_reakce,GET_FORMAT(DATETIME,"EUR")) AS datum_reakce')            ->select('priorita.nazev AS priorita')            ->select('maly_popis')            ->select('CONCAT(fronta_osoba.osoba.jmeno," ",fronta_osoba.osoba.prijmeni) AS osoba_prirazen'));        $this->addColumn('id', 'ID', '50px')            ->setTableName('incident.id')            ->setRenderer(function ($row) use ($presenter) {                return \Nette\Utils\Html::el('a')->setText($row['idTxt'])->href($presenter->link("Incident:edit", $row['id']));            })            ->setNumericFilter();        $this->addColumn('nazevCi', 'Produkt')            ->setTableName('incident.ci')            ->setSelectFilter($this->ci->fetchPairs('id', 'nazev'));        $this->addColumn('maly_popis', 'Obsah', '350px');        $this->addColumn('datum_ukonceni', 'Datum dokončení', '150px');        $this->addColumn('osoba_prirazen', 'Specialista', '110px');        $this->addColumn('priorita', 'Priorita')            ->setSelectFilter($this->priorita->fetchPairs('id', 'nazev'));        $this->addColumn('stav', 'Stav', '100px')            ->setTableName('incident_stav')            ->setSelectFilter($this->stav->fetchPairs('id', 'nazev'));        //Předáme zdroj        $this->setDataSource($source);    }}