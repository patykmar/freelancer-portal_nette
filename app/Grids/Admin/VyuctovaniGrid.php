<?phpnamespace App\Grids\Admin;use Nette\Database\Table\Selection;use Nette\Utils\Html;use NiftyGrid\DataSource\NDataSource;use NiftyGrid\DuplicateColumnException;use NiftyGrid\Grid;/** * Description of VyuctovaniGrid * * @author Martin Patyk */class VyuctovaniGrid extends Grid{    /** @var Selection Description */    private $model;    public function __construct($db)    {        parent::__construct();        $this->model = $db;    }    /**     * @throws DuplicateColumnException     */    protected function configure($presenter)    {        $this->model            ->select('COUNT(incident.id) AS pocet_tiketu')            ->select('ci.firma.nazev AS firma')            ->select('ci.firma.id AS firmaid')            ->select('ROUND(sum(ukon.cena * ovlivneni.koeficient_cena * typ_incident.koeficient_cena * priorita.koeficient_cena * zpusob_uzavreni.koeficient_cena),2) AS celkem')            ->group('ci.firma.id')            ->where(array(                'incident_stav' => 5,                'faktura' => NULL,            ));        $source = new NDataSource($this->model);        $this->addColumn('firma', 'firma', '350px');        $this->addColumn('pocet_tiketu', 'ks', '50px');        $this->addColumn('celkem', 'Celkem v Kč', '150px')            ->setRenderer(function ($row) use ($presenter) {                return Html::el('a', array(                    'target' => '_blank',                    'title' => 'Vygeneruj fakturu',                ))                    ->setText($row['celkem'])                    ->href($presenter->link("generujFakturu", $row['firmaid']));            });        $this->setDefaultOrder("celkem DESC");        $this->setDataSource($source);    }}